services:
  # PostgreSQL Database
  - type: pserv
    name: rentacar-db
    env: docker
    plan: free
    region: oregon
    databases:
      - name: rentacardb
        databaseName: rentacardb
        user: rentacar_user

  # .NET Web Service
  - type: web
    name: rentacar-api
    env: docker
    plan: free
    region: oregon
    buildCommand: dotnet publish RentACar.API/RentACar.API.csproj -c Release -o out
    startCommand: dotnet out/RentACar.API.dll
    envVars:
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: ASPNETCORE_URLS
        value: http://+:80
      - key: ConnectionStrings__DefaultConnection
        fromDatabase:
          name: rentacar-db
          property: connectionString
      - key: TokenOptions__Audience
        value: www.rentacar.com
      - key: TokenOptions__Issuer
        value: www.rentacar.com
      - key: TokenOptions__AccessTokenExpiration
        value: 60
      - key: TokenOptions__SecurityKey
        generateValue: true